#!/usr/bin/env bash
set -eo pipefail
[[ $DOKKU_TRACE ]] && set -x

export PLUGIN_UNIMPLEMENTED_SUBCOMMANDS=()
export PLUGIN_COMMAND_PREFIX="litestream"
export PLUGIN_CONFIG_ROOT=${PLUGIN_CONFIG_ROOT:="$DOKKU_LIB_ROOT/config/$PLUGIN_COMMAND_PREFIX"}
export PLUGIN_DATA_ROOT=${PLUGIN_DATA_ROOT:="$DOKKU_LIB_ROOT/services/$PLUGIN_COMMAND_PREFIX"}

export PLUGIN_DATA_HOST_ROOT=$POSTGRES_HOST_ROOT
export PLUGIN_BASE_PATH="$PLUGIN_PATH"

export LITESTREAM_IMAGE=${LITESTREAM_IMAGE:="litestream/litestream"}
export LITESTREAM_IMAGE_VERSION=${LITESTREAM_IMAGE_VERSION:="0.3.8"}

export LITESTREAM_CREDENTIALS_ROOT="$PLUGIN_CONFIG_ROOT/credentials"
export LITESTREAM_CREDENTIALS_ACCESS_KEY_ID="$LITESTREAM_CREDENTIALS_ROOT/ACCESS_KEY_ID"
export LITESTREAM_CREDENTIALS_SECRET_ACCESS_KEY="$LITESTREAM_CREDENTIALS_ROOT/SECRET_ACCESS_KEY"

export PLUGIN_DISABLE_PULL=${LITESTREAM_DISABLE_PULL:=}
export PLUGIN_DISABLE_PULL_VARIABLE="LITESTREAM_DISABLE_PULL"
export PLUGIN_IMAGE=$LITESTREAM_IMAGE
export PLUGIN_IMAGE_VERSION=$LITESTREAM_IMAGE_VERSION
